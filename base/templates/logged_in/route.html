{% extends 'base.html' %}
{% load static %}
{% load bootstrap3 %}
{{ form.media }}
{% load render_table from django_tables2 %}

{% block content %}
<title>Plan your routes</title>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.16/af-2.2.2/b-1.4.2/r-2.2.0/sc-1.4.3/sl-1.2.3/datatables.min.css"/>

<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.16/af-2.2.2/b-1.4.2/r-2.2.0/sc-1.4.3/sl-1.2.3/datatables.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.41.0/mapbox-gl.js'></script>

<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.41.0/mapbox-gl.css' rel='stylesheet' />


<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">View Routes for Date {{date}}</h1>
            <form id="date-form" method="post" action="{% url 'route_update' %}"> {% csrf_token %}
                <input id="datepicker" name="date" value="{{date}}">
                <button type="submit" class="btn btn-primary">Load routes for date</button>
            </form>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <div id="messages">
    </div>
    <p>Select rows to view routes</p>
    <div class="row">
        <!--<form id="form" action="{% url 'dashboard' %}", method="post">-->
        <div class="hide"><input></div>
        <div id="table-and-map">
            {% include 'route_view.html' %}
        </div>
        <!--</form>-->
    </div>
</div>
<script>
bootstrap_alert = function() {}
bootstrap_alert.warning = function(message) {
  $('#messages').html('<div class="alert alert-danger alert-dismissable">\
                       <button type="button" class="close" data-dismiss="alert" aria-hidden="true">\
                       &times;</button><span style="font-size:18px">'+message+'</span></div>')
}

$("#date-form").submit(function(event) {
  event.preventDefault();
  var $form = $( this ),
      url = $form.attr( 'action' );
  $('#table-and-map').css('visibility', 'invisible');
  $('#spinner').removeClass('hide')
  $.ajax({
    type: "POST",
    dataType: "html",
    url: url,
    data: $form.serialize(),
    success: function(data) {
      $('#table-and-map').html(data);
      $('#table-and-map').css('visibility', 'visible');
      $('.page-header').html('View Routes for Date ' + $form[0][1].value);
      $('.alert').alert('close');
    },
    error: function(data) {
      bootstrap_alert.warning('There was an error retrieving routes for date ' + $form[0][1].value + '.');
    }
  });
});

$(document).ready(function() {
  $('#datepicker').datepicker({
    changeMonth: true,
    changeYear: true});

  if ('{{ errors }}') {
    bootstrap_alert.warning('{{errors}}')
  }
});
</script>
<style type="text/css">
.hide {
  display: none;
}
</style>
{% endblock %}

